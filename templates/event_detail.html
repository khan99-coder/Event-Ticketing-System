{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

  <div class="event-details">
    <h1>{{ event.title }}</h1>
    <p><strong>Description:</strong> {{ event.description }}</p>
    <p><strong>Date:</strong> {{ event.date }}</p>
    <p><strong>Time:</strong> {{ event.time }}</p>
    <p><strong>Location:</strong> {{ event.location }}</p>
    <button class="btn btn-primary">BUY TICKETS</button>
  </div>

  <div class="ticket-details">
    <h2>Ticket Details</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Ticket</th>
          <th>Unit Cost</th>
          <th>Count</th>
          <th>Sub Total</th>
        </tr>
      </thead>
      <tbody>
        {% for ticket in event.tickets %}
          <tr>
            <td>{{ ticket.ticket_type }}</td>
            <td>{{ ticket.price }}</td>
            <td>
              <!-- Input box to select ticket quantity -->
              <input type="number" name="ticket_quantity" min="0" max="10" value="0" onchange="calculateSubtotal(this, {{ ticket.price }})" />
            </td>
            <td>
              <span id="subtotal_{{ ticket.ticket_type }}">Kshs 0.00</span>
            </td>
          </tr>
        {% endfor %}
        <tr>
          <td colspan="2"></td>
          <td>TOTAL ITEMS</td>
          <td id="total_items_subtotal">Kshs 0.00</td>
        </tr>
      </tbody>
    </table>
  </div>
  

  <!-- Rest of the content and scripts if any -->

  <script>
    function calculateSubtotal(input, unitCost) {
      const count = input.value;
      const subtotal = count * unitCost;
      const ticketType = input.closest('tr').querySelector('td:first-child').innerText;
      const subtotalElement = document.getElementById(`subtotal_${ticketType}`);
      subtotalElement.innerText = `Kshs ${subtotal.toFixed(2)}`;
      updateTotalSubtotal();
    }

    function updateTotalSubtotal() {
      const subtotals = document.querySelectorAll('[id^="subtotal_"]');
      let totalSubtotal = 0;
      subtotals.forEach(subtotal => {
        totalSubtotal += parseFloat(subtotal.innerText.replace('Kshs ', ''));
      });
      const totalSubtotalElement = document.getElementById('total_items_subtotal');
      totalSubtotalElement.innerText = `Kshs ${totalSubtotal.toFixed(2)}`;
    }
  </script>
{% endblock %}
